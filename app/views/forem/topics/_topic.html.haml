- last_post = @last_post_and_count[topic.id][0]

.topic{:class => ('ninja-ban' if user_signed_in? and current_user.admin? and topic.user.ninja_banned?)}
  .large-1.columns.avatar.hide-for-small
    = avatar_link last_post.user, :thumb_small
  .large-10.columns.topic-info
    .topic-title
      = link_to topic.subject, forem.forum_topic_path(topic.forum, topic)
      
      - if user_signed_in? and view = topic.view_for(current_user)
        - if (newest_unread = topic.posts.where(["created_at > ?", view.updated_at]).first)
          - seen_count = topic.posts.where(["created_at <= ?", view.updated_at]).count
          - page_number = 1 + seen_count / Forem.per_page
          = link_to forem.forum_topic_path(topic.forum, topic, page: page_number, anchor: "post#{newest_unread.id}") do
            %span.label new
      - elsif user_signed_in? and view.nil?
        = link_to forem.forum_topic_path(topic.forum, topic) do
          %span.label new

    %p.sub-text
      = distance_of_time_in_words_to_now(topic.last_post_at)
      ago by
      = link_to last_post.user.name, main_app.user_path(last_post.user)
      to
      = link_to topic.forum.title, forem.forum_path(topic.forum)
      
  .large-1.columns.comment-count
    %p
      - if topic.pinned?
        %i.icon-pushpin
      - elsif topic.locked?
        %i.icon-lock
      - else
        %i.icon-comments
      
      - unless topic.locked?
        = @last_post_and_count[topic.id][1] - 1

/<tr class="topic <%= cycle('odd', 'even') %> <%= topic.locked? ? 'locked' : 'unlocked' %>">
/  <td class='icon'>
/    <% if topic.locked? %>
/      <span class='lock icon'></span>
/    <% end %>
/    <% if topic.pinned? %>
/      <span class='pin icon'></span>
/    <% end %>
/    <% if forem_user && view = topic.view_for(forem_user) %>
/      <% if topic.posts.exists?(["created_at > ?", view.updated_at]) %>
/        <span class='new_posts icon'>new</span>
/      <% end %>
/    <% end %>
/  </td>
/  <td class='byline'>
/    <%= new_since_last_view_text(topic) %>
/    <div class='subject'><%= link_to forem_emojify(topic.subject), forem.forum_topic_path(@forum, topic) %></div>
/    <div class='started-by'><%= t "started_by" %><%= relevant_posts(topic).first.user %></div>
/  </td>
/  <td class='latest-post'>
/    <%= link_to_latest_post(topic) -%>
/  </td>
/  <td class='posts-count'><%= relevant_posts(topic).count %></td>
/  <td class='views-count'><%= topic.views_count %></td>
/</tr>
