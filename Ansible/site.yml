---
# Set up user accounts.
# Create the `vikhyat` user.
- hosts: all
  sudo: True
  vars:
    # Generated using `openssl passwd -salt vvlauihd -1 <password>`
    password: $1$vvlauihd$Y8y4qAiPWLW6GDnbpPtL3.
  tasks:
  - name: Create vikhyat user account
    action: user name=vikhyat password={{password}} groups=sudo append=yes shell=/bin/bash
  - name: Update apt cache
    apt: update_cache=yes

- hosts: all
  vars:
  - rbenv_root: /usr/local/rbenv
  - ruby_version: 2.1.0
  sudo: True
  roles:
  - common

- hosts: webservers
  sudo: True
  roles:
  - webservers

- hosts: sidekiq
  sudo: True
  roles:
  - sidekiq

- hosts: dbservers
  sudo: True
  vars:
    postgres_password: $1$vvlauihd$Y8y4qAiPWLW6GDnbpPtL3.
  roles:
  - dbservers

- hosts: dbservers
  sudo: True
  sudo_user: postgres
  tasks:
  - include: roles/dbservers/tasks/setup_db.yml

- hosts: redis
  sudo: True
  roles:
  - redis

- hosts: discourse
  sudo: True
  roles:
  - discourse

- hosts: beanstalkd
  sudo: True
  roles:
  - beanstalkd

- hosts: varnish
  sudo: True
  roles:
  - varnish

- hosts: mail
  sudo: True
  roles:
  - mail
